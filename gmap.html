<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Election Heatmap</title>
    <link href="gmapstyle.css" rel="stylesheet">
    <link href="bootstrap.css" rel="stylesheet">
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false&libraries=visualization"></script>

    <script type="text/javascript">
        document.write('<script type="text/javascript" src="http://google-maps-utility-library-v3.googlecode.com/svn/trunk/markermanager/src/markermanager.js"><'+'/script>');
    </script>
    <script>


var map, pointarray, heatmap;
var heatmaps = {};



function initialize() {
  var mapOptions = {
    zoom: 4,
    center: new google.maps.LatLng(-28.75,133.70),
    mapTypeId: google.maps.MapTypeId.ROADMAP
  };

  map = new google.maps.Map(document.getElementById('map-canvas'),
      mapOptions);


  loadParty("ALP", true);
  loadParty("GRN");
  loadParty("LP");
  loadParty("LNP");
  loadParty("NP");
  loadParty("PUP");

  toggleHeatmapParty("ALP");

  $(".partychange").click(function(){
	toggleHeatmapParty($(this).attr("value"));
   });



}

function loadParty(party, show){

  if(!party) return;

  var data = $.getJSON('./data/' + party + '.json', function(json) {

	var partydata = [];

	for (var i=0; i < json.data.length; i++){
		var line = {location: new google.maps.LatLng( json.data[i].lat, json.data[i].lng), weight: json.data[i].count}	;
		partydata.push(line);	
	}

	heatmaps[party] = new google.maps.visualization.HeatmapLayer({
	   data: partydata ,
           opactity: 0.9,
	   maxIntensity: 60,
	   dissipating: true 
	});

	if(show){
		heatmaps[party].setMap(map);
	}
	
  });
}


function toggleHeatmapParty(party){

	$.each(heatmaps, function(key, value){
		if (key == party){
			value.setMap(map);
		}
		else{
			value.setMap(null);
		}
	});

	// and highlight the button
	$("button.partychange").removeClass("btn-info");
	$("button.partychange[value='" + party + "']").addClass("btn-info");
}


function changeRadius() {
  heatmap.setOptions({radius: heatmap.get('radius') ? null : 20});
}

function changeOpacity() {
  heatmap.setOptions({opacity: heatmap.get('opacity') ? null : 0.2});
}

google.maps.event.addDomListener(window, 'load', initialize);

    </script>
  </head>

  <body>

<div class="navbar navbar-inverse navbar-fixed-static">
  <div class="navbar-inner">
    <span class="brand">Election Heatmap</span>
      <button class="partychange btn" value="ALP">ALP</button>
      <button class="partychange btn" value="GRN">Greens</button>
      <button class="partychange btn" value="LP">Liberal</button>
      <button class="partychange btn" value="LNP">LNP</button>
      <button class="partychange btn" value="NP">National</button>
      <button class="partychange btn" value="PUP">Palmer</button>
      <span class="pull-right"><a class="brand" href="http://twitter.com/peterneish">@peterneish</a></span>
  </div>
</div>
    <div id="map-canvas"></div>
  </body>
</html>
