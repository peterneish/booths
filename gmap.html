<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Election Heatmap</title>
    <link href="gmapstyle.css" rel="stylesheet">
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false&libraries=visualization"></script>

    <script type="text/javascript">
        document.write('<script type="text/javascript" src="http://google-maps-utility-library-v3.googlecode.com/svn/trunk/markermanager/src/markermanager.js"><'+'/script>');
    </script>
    <script>


var map, pointarray, heatmap;
var heatmaps = {};


var taxiData = [
  new google.maps.LatLng(-27.782551, 122.445368),
  new google.maps.LatLng(-27.782745, 122.444586),
  new google.maps.LatLng(-27.782842, 122.443688),
  new google.maps.LatLng(-27.762932, 122.405398),
  new google.maps.LatLng(-27.762126, 122.405813),
  new google.maps.LatLng(-27.751266, 122.403355)
];

function initialize() {
  var mapOptions = {
    zoom: 4,
    center: new google.maps.LatLng(-28.75,133.70),
    mapTypeId: google.maps.MapTypeId.ROADMAP
  };

  map = new google.maps.Map(document.getElementById('map-canvas'),
      mapOptions);


  var pointArray = new google.maps.MVCArray(taxiData);

  heatmap = new google.maps.visualization.HeatmapLayer({
    data: pointArray
  });

  //heatmap.setMap(map);

  loadParty("ALP");
  loadParty("GRN");

  toggleHeatmapParty("GRN");

  $(".partychange").click(function(){
	toggleHeatmapParty($(this).attr("value"));
   });



}

function loadParty(party){

  if(!party) return;

  var data = $.getJSON('./data/' + party + '.json', function(json) {

	var partydata = [];

	for (var i=0; i < json.data.length; i++){
		var line = {location: new google.maps.LatLng( json.data[i].lat, json.data[i].lng), weight: json.data[i].count}	;
		partydata.push(line);	
	}

	heatmaps[party] = new google.maps.visualization.HeatmapLayer({
	   data: partydata ,
           opactity: 0.9,
	   maxIntensity: 60,
	   dissipating: true 
	});
	heatmaps[party].setMap(map);
	
  });
}


function toggleHeatmap() {
  heatmap.setMap(heatmap.getMap() ? null : map);
}

function toggleHeatmapParty(party){

	console.log("Changing party to " + party);
	$.each(heatmaps, function(key, value){
		if (key == party){
			value.setMap(map);
		}
		else{
			value.setMap(null);
		}
	});
}


function changeRadius() {
  heatmap.setOptions({radius: heatmap.get('radius') ? null : 20});
}

function changeOpacity() {
  heatmap.setOptions({opacity: heatmap.get('opacity') ? null : 0.2});
}

google.maps.event.addDomListener(window, 'load', initialize);

    </script>
  </head>

  <body>
    <div id="panel">
      <button onclick="toggleHeatmap()">Toggle Heatmap</button>
      <button onclick="changeRadius()">Change radius</button>
      <button onclick="changeOpacity()">Change opacity</button>
      <button class="partychange" value="GRN">Greens</button>
      <button class="partychange" value="ALP">ALP</button>
    </div>
    <div id="map-canvas"></div>
  </body>
</html>
